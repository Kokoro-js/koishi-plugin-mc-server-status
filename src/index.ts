import { Context, Schema } from 'koishi'
import { mcs } from './commands/mcs'
import { bind } from './commands/mcs.bind'

export const name = 'mc-server-status'

export const inject = [
  'puppeteer',
  'database'
]

export interface Config {
  data_collect: boolean,
  IP: string
  icon: boolean
  motd: boolean
  skipSRV: boolean
  authority: number
  footer: string
  bedrockSupport: boolean
  dnsServer: string
}

export const Config: Schema<Config> = Schema.object({
  data_collect: Schema
    .boolean()
    .default(true)
    .description('æ˜¯å¦å…è®¸åŒ¿åæ•°æ®æ”¶é›† éšç§æ”¿ç­–è§ä¸Šæ–¹é“¾æ¥'),
  authority: Schema
    .number()
    .default(0)
    .description('é»˜è®¤æŒ‡ä»¤æƒé™ç­‰çº§ (mcs)'),
  dnsServer: Schema.string()
    .description('DNSæœåŠ¡å™¨')
    .default('223.6.6.6'),
  skipSRV: Schema.boolean()
    .description('æ˜¯å¦è·³è¿‡SRVè®°å½•')
    .default(false),
  IP: Schema.string()
    .required(true)
    .description('é»˜è®¤æœåŠ¡å™¨IP'),
  icon: Schema.boolean()
    .default(true)
    .description('æ˜¯å¦æ˜¾ç¤ºæœåŠ¡å™¨å›¾æ ‡'),
  motd: Schema.boolean()
    .default(true)
    .description('æ˜¯å¦æ˜¾ç¤ºæœåŠ¡å™¨MOTD'),
  footer: Schema.string()
    .role('textarea', { rows: [2, 4] })
    .default('Generated by koishi-plugin-mc-server-manager v3.1.3\nå»¶è¿Ÿä»…ä¾›å‚è€ƒ')
    .description('æœ€ä¸‹æ–¹æ˜¾ç¤ºçš„æ–‡å­— (å¯ä»¥å¤šè¡Œ)'),
  bedrockSupport: Schema.boolean()
    .default(false)
    .description('æ˜¯å¦å¯ç”¨Minecraft: Bedrock EditionæœåŠ¡å™¨æ”¯æŒ')
    .deprecated()
})

export const usage = `
<h2>å¦‚é‡ä½¿ç”¨é—®é¢˜å¯ä»¥å‰å¾€QQç¾¤: 957500313 è®¨è®º<h2>
<h2>åŸºå²©ç‰ˆæ”¯æŒå·²è¢«æ”¾å¼ƒ</h2>
<h2> åŒ¿åæ•°æ®æ”¶é›† ğŸ‘‰ <a href="https://legal.itzdrli.com">éšç§æ”¿ç­–</a> </h2>
<p>è¯·æˆ‘å–æ¯å’–å•¡ ğŸ‘‡</br><a href="https://ko-fi.com/itzdrli"><img src="https://img.shields.io/badge/Ko--fi-F16061?style=for-the-badge&logo=ko-fi&logoColor=white" alt="ko-fi"></a></p> <a href="https://afdian.net/a/itzdrli">
  <button>çˆ±å‘ç”µ</button>
</a>
`

declare module 'koishi' {
  interface Tables {
    mc_server_status: McServerStatus
  }
}

export interface McServerStatus {
  id: string
  server_ip: string
}

export function apply(ctx: Context, config: Config) {
  
  const logger = ctx.logger('mc-server-status');
  ctx.model.extend('mc_server_status', {
    id: 'string',
    server_ip: 'string'
  }, {})
  mcs(ctx, config)
  bind(ctx, config)
}
